# 第3章 目标文件里有什么
## 3.1 目标文件的格式
linux下可执行文件格式为ELF。可执行文件，动态链接库，静态链接库按照ELF文件格式存储。

ELF格式的文件分为四类。
|类型|说明|实例|
|-|-|-|
|可重定位文件（relocatable）|包含代码和数据，可被用来链接成可执行文件或共享目标文件，静态链接库属于这一类|linux下的 .o 文件|
|可执行文件（executable）|包含了可以执行的程序|/bin/bash文件|
|共享目标文件（shared object）|包含代码和数据，可在两种情况下使用。一、产生新的目标文件，二、动态链接器可将它与可执行文件结合，作为进程映像的一部分来运行。|.so|
|核心转储文件（core dump）|进程意外终止时存储信息|linux下的 core dump|
可使用 `file ${filename}`查看文件信息。
## 3.2 目标文件结构
一般C语言编译后执行语句都被编译成机器代码，保存在.text段。

已初始化的全局变量和局部静态变量都保存在 .data 段。

未初始化的全局变量和局部静态变量都保存在 .bss 段。

**总体来说，程序源代码被编译后主要分成两种段：程序指令和程序数据。代码段属于程序指令，而数据段和.bss属于程序数据。**

指令与数据分开存储好处：
1. 当程序被装载后，数据和指令分别被映射到两个虚内存区。数据区对进程来说是可读可写的，而指令区只是可读的。分别设置不同的权限可以防止程序指令被修改。
2. 现代CPU有强大的缓存体系，分开存储有利于提高程序的缓存命中率。
3. 最重要的原因，当系统运行多个该程序的副本时，他们的指令相同，所以内存中只需保存一份指令部分。数据部分则是每个进程私有的。