# 网络

## 12.3 通过套接字通信

虽然在linux/unix中，遵循“一且皆文件”，但是对网卡而言情况则更为复杂。网卡的运作方式与普通的块设备和字符设备不同，一个原因是使用了许多不同的协议，为建立连接需要指定许多选项，且无法在打开设备时完成这些任务。因此在/dev目录下没有网卡相关项（某些虚拟设备除外）。因此，拥有特殊结构的套接字被创造出来用于作为网络实现的接口。现在的套接字可以按照操作inode的方法来访问网络。从程序员角度来看，创建套接字的结果是一个文件描述符。

### 12.3.3 数据报套接字

分别使用TCP和UDP协议的进程，可以同时使用相同的IP地址和端口号。在多路复用时，内核会根据分组的传输协议类型，将其转发到适当的进程。

## 12.6 套接字缓冲区

**套接字缓冲区（socket buffer）**：内核收到网分组时，底层协议的数据将传递到更高的层。发送数据时顺序相反，各种协议产生的数据（首部和净荷）依次向更低的层传递，直至最终发送。在内核中定义为`struct sk_buff`，位于`<skbuff.h>`中。套接字缓冲区用于在网络实现的各层次之间交换数据，而无需来回复制分组数据。

### 12.6.1 使用套接字缓冲区管理数据

套接字缓冲区通过其中的指针与一个内存区域相关联，网络分组的数据就位于该区域中。**套接字缓冲区的基本思想是，通过操作指针来增删协议首部。**